<ng-container *ngIf="!child">
    <div
        class="fuse-horizontal-navigation-item-wrapper"
        [class.fuse-horizontal-navigation-item-has-subtitle]="!!item.subtitle"
        [ngClass]="item.classes?.wrapper">
        <div
            class="fuse-horizontal-navigation-item"
            [ngClass]="{'fuse-horizontal-navigation-item-disabled': item.disabled,
                         'fuse-horizontal-navigation-item-active-forced': item.active,
                         'fuse-horizontal-navigation-menu-active': menuOpen}"
            [pTooltip]="item.tooltip || ''"
            (click)="toggleOverlay($event, overlayPanel)">
            <ng-container
                [ngTemplateOutlet]="itemContent"
                [ngTemplateOutletContext]="{$implicit: item}"></ng-container>
        </div>
    </div>

    <p-overlayPanel
        #overlayPanel="overlayPanel"
        [dismissable]="true"
        [showCloseIcon]="false"
        [styleClass]="'fuse-horizontal-navigation-menu-panel'"
        (onShow)="onOverlayShow()"
        (onHide)="onOverlayHide()">
        <ng-container
            *ngIf="item.children?.length"
            [ngTemplateOutlet]="menuTemplate"
            [ngTemplateOutletContext]="{$implicit: item.children}"></ng-container>
    </p-overlayPanel>
</ng-container>

<ng-container *ngIf="child">
    <div
        class="fuse-horizontal-navigation-item-wrapper"
        [class.fuse-horizontal-navigation-item-has-subtitle]="!!item.subtitle"
        [ngClass]="item.classes?.wrapper">
        <div
            class="fuse-horizontal-navigation-item"
            [ngClass]="{'fuse-horizontal-navigation-item-disabled': item.disabled,
                         'fuse-horizontal-navigation-item-active-forced': item.active,
                         'fuse-horizontal-navigation-menu-active': menuOpen}"
            [pTooltip]="item.tooltip || ''"
            (click)="toggleChildMenu()">
            <ng-container
                [ngTemplateOutlet]="itemContent"
                [ngTemplateOutletContext]="{$implicit: item}"></ng-container>
        </div>

        <div
            class="fuse-horizontal-navigation-menu-children"
            *ngIf="menuOpen && item.children?.length">
            <ng-container
                [ngTemplateOutlet]="menuTemplate"
                [ngTemplateOutletContext]="{$implicit: item.children}"></ng-container>
        </div>
    </div>
</ng-container>

<ng-template
    #menuTemplate
    let-children>
    <ng-container *ngFor="let child of children; trackBy: trackByFn">

        <!-- Skip the hidden items -->
        <ng-container *ngIf="(child.hidden && !child.hidden(child)) || !child.hidden">

            <!-- Basic -->
            <ng-container *ngIf="child.type === 'basic'">
                <div
                    class="fuse-horizontal-navigation-menu-item"
                    [class.fuse-horizontal-navigation-menu-item-disabled]="child.disabled">
                    <fuse-horizontal-navigation-basic-item
                        [item]="child"
                        [name]="name"></fuse-horizontal-navigation-basic-item>
                </div>
            </ng-container>

            <!-- Branch: aside, collapsable, group -->
            <ng-container *ngIf="child.type === 'aside' || child.type === 'collapsable' || child.type === 'group'">
                <div
                    class="fuse-horizontal-navigation-menu-item"
                    [class.fuse-horizontal-navigation-menu-item-disabled]="child.disabled">
                    <fuse-horizontal-navigation-branch-item
                        [child]="true"
                        [item]="child"
                        [name]="name"></fuse-horizontal-navigation-branch-item>
                </div>
            </ng-container>

            <!-- Divider -->
            <ng-container *ngIf="child.type === 'divider'">
                <div class="fuse-horizontal-navigation-menu-item">
                    <fuse-horizontal-navigation-divider-item
                        [item]="child"
                        [name]="name"></fuse-horizontal-navigation-divider-item>
                </div>
            </ng-container>

        </ng-container>

    </ng-container>
</ng-template>

<ng-template
    #itemContent
    let-item>

    <!-- Icon -->
    <ng-container *ngIf="item.icon">
        <fuse-icon
            class="fuse-horizontal-navigation-item-icon"
            [ngClass]="item.classes?.icon"
            [svgIcon]="item.icon"></fuse-icon>
    </ng-container>

    <!-- Title & Subtitle -->
    <div class="fuse-horizontal-navigation-item-title-wrapper">
        <div class="fuse-horizontal-navigation-item-title">
            <span [ngClass]="item.classes?.title">
                {{item.title}}
            </span>
        </div>
        <ng-container *ngIf="item.subtitle">
            <div class="fuse-horizontal-navigation-item-subtitle text-hint">
                <span [ngClass]="item.classes?.subtitle">
                    {{item.subtitle}}
                </span>
            </div>
        </ng-container>
    </div>

    <!-- Badge -->
    <ng-container *ngIf="item.badge">
        <div class="fuse-horizontal-navigation-item-badge">
            <div
                class="fuse-horizontal-navigation-item-badge-content"
                [ngClass]="item.badge.classes">
                {{item.badge.title}}
            </div>
        </div>
    </ng-container>
</ng-template>
